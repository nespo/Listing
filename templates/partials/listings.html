{% load humanize %}

{% for listing in listings %}
<div class="listing-box {% if listing.is_featured %}featured-listing{% endif %}" id="listing-{{ listing.id|safe }}">
    {% if listing.is_featured %}
    <div class="featured">Featured</div>
    {% endif %}
    <div class="listing-thumbnail-image">
        <a href="{% url 'listing_detail' listing.slug %}" class="listing-popup-link">
            {% if listing.thumbnail_image %}
            <img src="{{ listing.thumbnail_image.url }}" alt="Image for {{ listing.project_name|safe }}">
            {% else %}
            <img src="https://www.contentviewspro.com/wp-content/uploads/2017/07/default_image.png" alt="Default image">
            {% endif %}
        </a>
    </div>
    <p><i class="fa fa-map-marker-alt" aria-hidden="true"></i> {{ listing.project_address|safe }}</p>
    <h2>{{ listing.project_name|safe }}</h2>
    {% if listing.categories.all %}
    <p><i class="fa fa-list-alt"></i> <strong>Category:</strong>
    {% for category in listing.categories.all %}
        {{ category.name }}{% if not forloop.last %}, {% endif %}
    {% endfor %}
    </p>
    {% endif %}
    {% if listing.project_size %}<p><i class="fas fa-ruler-combined"></i> <strong>Project Size (MW):</strong> {{ listing.project_size }}</p>{% endif %}
    {% if listing.projected_annual_income %}<p><i class="fas fa-chart-line"></i> <strong>Projected Annual Income:</strong> $ {{ listing.projected_annual_income|floatformat:0|intcomma }}</p>{% endif %}
    {% if listing.project_ntp_date %}<p><i class="fas fa-calendar-alt"></i> <strong>Project NTP Date:</strong> {{ listing.project_ntp_date }}</p>{% endif %}
    {% if listing.project_cod_date %}<p><i class="fas fa-calendar-alt"></i> <strong>Project COD Date:</strong> {{ listing.project_cod_date }}</p>{% endif %}
    {% if listing.project_pto_date %}<p><i class="fas fa-calendar-alt"></i> <strong>Project PTO Date:</strong> {{ listing.project_pto_date }}</p>{% endif %}
    <div class="listing-bottom">
        <p class="price">Price: $ {{ listing.sales_price|floatformat:0|intcomma }}</p> <!-- Ensure decimal is properly formatted and then apply intcomma -->
        <a href="{% url 'listing_detail' listing.slug %}" class="view-details-btn">View Details</a>
    </div>
</div>
{% endfor %}
